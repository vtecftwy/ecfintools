# core


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

# 

## Legacy function from former package `finutilities`

Set of functions that are transferred from my former package
`finutilities`

------------------------------------------------------------------------

<a
href="https://github.com/vtecftwy/myquantlab/blob/main/myquantlab/core.py#L19"
target="_blank" style="float:right; font-size:smaller">source</a>

### safe_date

>  safe_date (dt:str|datetime.datetime)

\*Return a datetime object from string or datetime

Accepted formats:

- ‘YYYY-MM-DD’, ‘YYYY/MM/DD’, ‘YYYY.MM.DD’
- ‘HH:MM:SS’ can be added to the above formats\*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>dt</td>
<td>str | datetime.datetime</td>
<td>date time to validate or convert</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>datetime</strong></td>
<td><strong>datetime type object</strong></td>
</tr>
</tbody>
</table>

This function converts date-time strings into a `datetime` object, as
long as the strings are in one of the following formats:

- `2024-12-15 21:02:17`
- `2024/12/15 21:02:17`
- `2024.12.15 21:02:17`
- `2024-12-15`
- `2024/12/15`
- `2024.12.15`

The function also accepts a datetime as argument `dt` and can be used to
ensure a data argument used in a function is a `datetime` object.

``` python
assert isinstance(safe_date('2024-12-15 21:02:17'), datetime)
assert isinstance(safe_date('2024/12/15 21:02:17'), datetime)
assert isinstance(safe_date('2024.12.15 21:02:17'), datetime)
assert isinstance(safe_date('2024-12-15'), datetime)
assert isinstance(safe_date('2024/12/15'), datetime)
assert isinstance(safe_date('2024.12.15'), datetime)
assert isinstance(safe_date(datetime.now()), datetime)
```

------------------------------------------------------------------------

<a
href="https://github.com/vtecftwy/myquantlab/blob/main/myquantlab/core.py#L46"
target="_blank" style="float:right; font-size:smaller">source</a>

### time_slice_df

>  time_slice_df (df:pandas.core.frame.DataFrame,
>                     start:str|datetime.datetime|None=None,
>                     end:str|datetime.datetime|None=None)

*Slices DataFrame’s rows from start to end, or the closest datetime
available in the DataTimeIndex.*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>df</td>
<td>DataFrame</td>
<td></td>
<td><code>df</code> that will be sliced, must have a
<code>DateTimeIndex</code></td>
</tr>
<tr>
<td>start</td>
<td>str | datetime.datetime | None</td>
<td>None</td>
<td>start date for slicing</td>
</tr>
<tr>
<td>end</td>
<td>str | datetime.datetime | None</td>
<td>None</td>
<td>end date for slicing</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>DataFrame</strong></td>
<td></td>
<td><strong>sliced <code>df</code></strong></td>
</tr>
</tbody>
</table>

Even if we pass `start` and `end` dates that are not in the datafrane
`DateTimeIndex`, the function still will slice using the closest
datetime(s) in the index.

Let’s take an test dataframe for illustration.

------------------------------------------------------------------------

<a
href="https://github.com/vtecftwy/myquantlab/blob/main/myquantlab/core.py#L68"
target="_blank" style="float:right; font-size:smaller">source</a>

### load_test_df

>  load_test_df ()

``` python
df = load_test_df()
df.iloc[:15, :]
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
</tr>
<tr>
<th data-quarto-table-cell-role="th">dt</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">2018-10-22</td>
<td>2759.02</td>
<td>2779.27</td>
<td>2747.27</td>
<td>2754.48</td>
<td>26562</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-23</td>
<td>2753.11</td>
<td>2755.36</td>
<td>2690.69</td>
<td>2743.45</td>
<td>38777</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-24</td>
<td>2744.83</td>
<td>2748.58</td>
<td>2651.23</td>
<td>2672.80</td>
<td>41777</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-25</td>
<td>2670.80</td>
<td>2722.90</td>
<td>2657.93</td>
<td>2680.71</td>
<td>39034</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-26</td>
<td>2675.59</td>
<td>2692.34</td>
<td>2627.59</td>
<td>2663.57</td>
<td>61436</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-29</td>
<td>2667.70</td>
<td>2707.00</td>
<td>2603.33</td>
<td>2639.17</td>
<td>44960</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-30</td>
<td>2639.55</td>
<td>2689.50</td>
<td>2633.05</td>
<td>2688.50</td>
<td>52786</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-31</td>
<td>2688.88</td>
<td>2736.76</td>
<td>2681.25</td>
<td>2704.75</td>
<td>32374</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-11-01</td>
<td>2707.13</td>
<td>2741.58</td>
<td>2706.88</td>
<td>2731.90</td>
<td>29565</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-11-02</td>
<td>2725.28</td>
<td>2766.28</td>
<td>2699.96</td>
<td>2723.76</td>
<td>41892</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-11-05</td>
<td>2721.51</td>
<td>2744.41</td>
<td>2713.14</td>
<td>2740.26</td>
<td>25161</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-11-06</td>
<td>2739.39</td>
<td>2761.53</td>
<td>2730.14</td>
<td>2759.15</td>
<td>20481</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-11-07</td>
<td>2757.28</td>
<td>2816.63</td>
<td>2745.53</td>
<td>2815.88</td>
<td>29723</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-11-08</td>
<td>2814.76</td>
<td>2817.01</td>
<td>2794.68</td>
<td>2805.02</td>
<td>18369</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-11-09</td>
<td>2803.40</td>
<td>2810.15</td>
<td>2763.78</td>
<td>2778.60</td>
<td>25123</td>
</tr>
</tbody>
</table>

</div>

In this example, the DataFrame misses a few days, e.g.: - 2018-10-27 and
2018-10-28 - 2018-11-03 and 2018-11-04

If we pick one of these dates for `start` and `end` respectively, we
still get a sampled dataframe with the closed existing dates:

``` python
time_slice_df(df, '2018-10-27', '2018-11-04')
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
</tr>
<tr>
<th data-quarto-table-cell-role="th">dt</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">2018-10-29</td>
<td>2667.70</td>
<td>2707.00</td>
<td>2603.33</td>
<td>2639.17</td>
<td>44960</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-30</td>
<td>2639.55</td>
<td>2689.50</td>
<td>2633.05</td>
<td>2688.50</td>
<td>52786</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-31</td>
<td>2688.88</td>
<td>2736.76</td>
<td>2681.25</td>
<td>2704.75</td>
<td>32374</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-11-01</td>
<td>2707.13</td>
<td>2741.58</td>
<td>2706.88</td>
<td>2731.90</td>
<td>29565</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-11-02</td>
<td>2725.28</td>
<td>2766.28</td>
<td>2699.96</td>
<td>2723.76</td>
<td>41892</td>
</tr>
</tbody>
</table>

</div>
