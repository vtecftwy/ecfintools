# pipeline


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Custom transforms

Transforms applicable to preprocess and feature engineer financial data.

------------------------------------------------------------------------

<a
href="https://github.com/vtecftwy/myquantlab/blob/main/myquantlab/pipeline.py#L19"
target="_blank" style="float:right; font-size:smaller">source</a>

### MyBaseTransformer

>  MyBaseTransformer ()

*Base class for my custom transformers*

``` python
pipe = Pipeline([
    ('base-transformer', MyBaseTransformer())
])

df = load_test_df()
pipe.fit_transform(df)[:5,:]
```

    array([[ 2759.02,  2779.27,  2747.27,  2754.48, 26562.  ],
           [ 2753.11,  2755.36,  2690.69,  2743.45, 38777.  ],
           [ 2744.83,  2748.58,  2651.23,  2672.8 , 41777.  ],
           [ 2670.8 ,  2722.9 ,  2657.93,  2680.71, 39034.  ],
           [ 2675.59,  2692.34,  2627.59,  2663.57, 61436.  ]])

``` python
pd.DataFrame(data=pipe.fit_transform(df), columns=pipe.get_feature_names_out(), index=df.index).head(5)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open_transformed</th>
<th data-quarto-table-cell-role="th">High_transformed</th>
<th data-quarto-table-cell-role="th">Low_transformed</th>
<th data-quarto-table-cell-role="th">Close_transformed</th>
<th data-quarto-table-cell-role="th">Volume_transformed</th>
</tr>
<tr>
<th data-quarto-table-cell-role="th">dt</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">2018-10-22</td>
<td>2759.02</td>
<td>2779.27</td>
<td>2747.27</td>
<td>2754.48</td>
<td>26562.0</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-23</td>
<td>2753.11</td>
<td>2755.36</td>
<td>2690.69</td>
<td>2743.45</td>
<td>38777.0</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-24</td>
<td>2744.83</td>
<td>2748.58</td>
<td>2651.23</td>
<td>2672.80</td>
<td>41777.0</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-25</td>
<td>2670.80</td>
<td>2722.90</td>
<td>2657.93</td>
<td>2680.71</td>
<td>39034.0</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-26</td>
<td>2675.59</td>
<td>2692.34</td>
<td>2627.59</td>
<td>2663.57</td>
<td>61436.0</td>
</tr>
</tbody>
</table>

</div>

------------------------------------------------------------------------

<a
href="https://github.com/vtecftwy/myquantlab/blob/main/myquantlab/pipeline.py#L45"
target="_blank" style="float:right; font-size:smaller">source</a>

### ReturnTransformer

>  ReturnTransformer (periods:int=1)

*Evaluate the percentage return over 1 or more periods*

``` python
pipe = ColumnTransformer([
    ('r', ReturnTransformer(), ['Open', 'Close', 'Volume'])
])
pd.DataFrame(pipe.fit_transform(df), columns=pipe.get_feature_names_out(), index=df.index).head(5)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">r__Open_ret</th>
<th data-quarto-table-cell-role="th">r__Close_ret</th>
<th data-quarto-table-cell-role="th">r__Volume_ret</th>
</tr>
<tr>
<th data-quarto-table-cell-role="th">dt</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">2018-10-22</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-23</td>
<td>-0.002142</td>
<td>-0.004004</td>
<td>0.459867</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-24</td>
<td>-0.003008</td>
<td>-0.025752</td>
<td>0.077365</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-25</td>
<td>-0.026971</td>
<td>0.002959</td>
<td>-0.065658</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-26</td>
<td>0.001793</td>
<td>-0.006394</td>
<td>0.573910</td>
</tr>
</tbody>
</table>

</div>

------------------------------------------------------------------------

<a
href="https://github.com/vtecftwy/myquantlab/blob/main/myquantlab/pipeline.py#L60"
target="_blank" style="float:right; font-size:smaller">source</a>

### StdTransformer

>  StdTransformer (window:int=5)

*Evaluate the standard deviation over a window*

``` python
pipe = ColumnTransformer([
    ('returns', StdTransformer(3), ['Open', 'Close'])
])
pd.DataFrame(data=pipe.fit_transform(df), columns=pipe.get_feature_names_out(), index=df.index).head(5)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">returns__Open_std3</th>
<th data-quarto-table-cell-role="th">returns__Close_std3</th>
</tr>
<tr>
<th data-quarto-table-cell-role="th">dt</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">2018-10-22</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-23</td>
<td>4.179001</td>
<td>7.799388</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-24</td>
<td>7.127910</td>
<td>44.318367</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-25</td>
<td>45.320958</td>
<td>38.708953</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-26</td>
<td>41.427774</td>
<td>8.578467</td>
</tr>
</tbody>
</table>

</div>

------------------------------------------------------------------------

<a
href="https://github.com/vtecftwy/myquantlab/blob/main/myquantlab/pipeline.py#L74"
target="_blank" style="float:right; font-size:smaller">source</a>

### MATransformer

>  MATransformer (window:int=5)

*Evaluate the moving average over a window*

------------------------------------------------------------------------

<a
href="https://github.com/vtecftwy/myquantlab/blob/main/myquantlab/pipeline.py#L88"
target="_blank" style="float:right; font-size:smaller">source</a>

### EMATransformer

>  EMATransformer (window:int=5)

*Evaluate the exponential moving average over a window*

Build a pipeline applying these transforms to specific columns.

``` python
pipe = ColumnTransformer([
    ('thru', 'passthrough', ['Open', 'High', 'Low', 'Close', 'Volume']),
    ('ret', ReturnTransformer(3), ['Close']),
    ('ma', MATransformer(3), ['Close']),
    ('ema', EMATransformer(3), ['Open', 'Close'])
])
pd.DataFrame(data=pipe.fit_transform(df), columns=pipe.get_feature_names_out(), index=df.index).head(5)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">thru__Open</th>
<th data-quarto-table-cell-role="th">thru__High</th>
<th data-quarto-table-cell-role="th">thru__Low</th>
<th data-quarto-table-cell-role="th">thru__Close</th>
<th data-quarto-table-cell-role="th">thru__Volume</th>
<th data-quarto-table-cell-role="th">ret__Close_ret</th>
<th data-quarto-table-cell-role="th">ma__Close_MA3</th>
<th data-quarto-table-cell-role="th">ema__Open_EMA3</th>
<th data-quarto-table-cell-role="th">ema__Close_EMA3</th>
</tr>
<tr>
<th data-quarto-table-cell-role="th">dt</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">2018-10-22</td>
<td>2759.02</td>
<td>2779.27</td>
<td>2747.27</td>
<td>2754.48</td>
<td>26562.0</td>
<td>0.000000</td>
<td>2754.480000</td>
<td>2759.020000</td>
<td>2754.480000</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-23</td>
<td>2753.11</td>
<td>2755.36</td>
<td>2690.69</td>
<td>2743.45</td>
<td>38777.0</td>
<td>0.000000</td>
<td>2748.965000</td>
<td>2755.080000</td>
<td>2747.126667</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-24</td>
<td>2744.83</td>
<td>2748.58</td>
<td>2651.23</td>
<td>2672.80</td>
<td>41777.0</td>
<td>0.000000</td>
<td>2723.576667</td>
<td>2749.222857</td>
<td>2704.654286</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-25</td>
<td>2670.80</td>
<td>2722.90</td>
<td>2657.93</td>
<td>2680.71</td>
<td>39034.0</td>
<td>-0.026782</td>
<td>2698.986667</td>
<td>2707.397333</td>
<td>2691.884000</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-26</td>
<td>2675.59</td>
<td>2692.34</td>
<td>2627.59</td>
<td>2663.57</td>
<td>61436.0</td>
<td>-0.029117</td>
<td>2672.360000</td>
<td>2690.980645</td>
<td>2677.270323</td>
</tr>
</tbody>
</table>

</div>

------------------------------------------------------------------------

<a
href="https://github.com/vtecftwy/myquantlab/blob/main/myquantlab/pipeline.py#L102"
target="_blank" style="float:right; font-size:smaller">source</a>

### simplify_colnames

>  simplify_colnames (cols)

*Simplify the columns names by removing the prefix*

``` python
print(pipe.get_feature_names_out())
```

    ['thru__Open' 'thru__High' 'thru__Low' 'thru__Close' 'thru__Volume'
     'ret__Close_ret' 'ma__Close_MA3' 'ema__Open_EMA3' 'ema__Close_EMA3']

``` python
print(simplify_colnames(pipe.get_feature_names_out()))
```

    ['Open', 'High', 'Low', 'Close', 'Volume', 'Close_ret', 'Close_MA3', 'Open_EMA3', 'Close_EMA3']

``` python
df_proc = pd.DataFrame(
    data=pipe.fit_transform(df), 
    columns=simplify_colnames(pipe.get_feature_names_out()), 
    index=df.index)
df_proc.head(5)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">Close_ret</th>
<th data-quarto-table-cell-role="th">Close_MA3</th>
<th data-quarto-table-cell-role="th">Open_EMA3</th>
<th data-quarto-table-cell-role="th">Close_EMA3</th>
</tr>
<tr>
<th data-quarto-table-cell-role="th">dt</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">2018-10-22</td>
<td>2759.02</td>
<td>2779.27</td>
<td>2747.27</td>
<td>2754.48</td>
<td>26562.0</td>
<td>0.000000</td>
<td>2754.480000</td>
<td>2759.020000</td>
<td>2754.480000</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-23</td>
<td>2753.11</td>
<td>2755.36</td>
<td>2690.69</td>
<td>2743.45</td>
<td>38777.0</td>
<td>0.000000</td>
<td>2748.965000</td>
<td>2755.080000</td>
<td>2747.126667</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-24</td>
<td>2744.83</td>
<td>2748.58</td>
<td>2651.23</td>
<td>2672.80</td>
<td>41777.0</td>
<td>0.000000</td>
<td>2723.576667</td>
<td>2749.222857</td>
<td>2704.654286</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-25</td>
<td>2670.80</td>
<td>2722.90</td>
<td>2657.93</td>
<td>2680.71</td>
<td>39034.0</td>
<td>-0.026782</td>
<td>2698.986667</td>
<td>2707.397333</td>
<td>2691.884000</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">2018-10-26</td>
<td>2675.59</td>
<td>2692.34</td>
<td>2627.59</td>
<td>2663.57</td>
<td>61436.0</td>
<td>-0.029117</td>
<td>2672.360000</td>
<td>2690.980645</td>
<td>2677.270323</td>
</tr>
</tbody>
</table>

</div>
